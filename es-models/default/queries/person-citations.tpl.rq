PREFIX bibo: <http://purl.org/ontology/bibo/>
PREFIX cito: <http://purl.org/spar/cito/>
PREFIX experts: <http://experts.ucdavis.edu/>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX obo: <http://purl.obolibrary.org/obo/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX ucdrp: <http://experts.ucdavis.edu/schema#>
PREFIX vcard: <http://www.w3.org/2006/vcard/ns#>
PREFIX vitro: <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
PREFIX vivo: <http://vivoweb.org/ontology/core#>

CONSTRUCT {
  ?subject rdf:type ?type .
  ?subject rdf:type ucdrp:person .

  ?subject ucdrp:citation ?publication .
  ?publication rdfs:label ?publicationLabel .
  ?publication ucdrp:publication ?publicationVenueLabel .

  ?subject vivo:hasSubjectArea ?subjectArea .
  ?subjectArea rdfs:label ?subjectAreaLabel .

  ?publication ucdrp:authors ?citationAuthors .
  ?citationAuthors vivo:rank ?authorRank .
  ?citationAuthors vivo:identifiers ?citationPerson .
} WHERE {

  ?subject rdf:type ?type .

  OPTIONAL {
    ?subject vivo:relatedBy ?authorship .
    ?authorship rdf:type vivo:Authorship .

    ?authorship vivo:relates ?publication .
    ?publication rdf:type ucdrp:work .
    ?publication rdfs:label ?publicationLabel .

    OPTIONAL {
      ?publication vivo:relatedBy ?citationAuthors .
      ?citationAuthors rdf:type vivo:Authorship .
      ?citationAuthors vivo:relates ?citationPerson .
      ?citationPerson rdf:type ?citationPersonType .

      OPTIONAL {
        ?citationAuthors vivo:rank ?authorRank .
      }
    }
    OPTIONAL {
      ?publication vivo:hasPublicationVenue ?publicationVenue .
      ?publicationVenue rdfs:label ?publicationVenueLabel .
      ?subject vivo:hasSubjectArea ?subjectArea .
      ?subjectArea rdfs:label ?subjectAreaLabel .
    }
  }
  FILTER(
    ?subject = "{{uri}}" &&
    ?citationPersonType IN (vcard:Individual, vivo:FacultyMember, vivo:NonAcademic, foaf:Person))
}
